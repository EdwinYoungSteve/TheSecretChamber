<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>å¼€å¹•æ¸¸æˆ</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'å¾®è½¯é›…é»‘', Arial, sans-serif;
        }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        .background {
            position: absolute;
            width: 100vw;
            height: 100vh;
            object-fit: cover;
            z-index: 0;
        }
        .center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
        }
        .btn {
            padding: 16px 32px;
            font-size: 1.5em;
            border: none;
            border-radius: 8px;
            background: #0078d7;
            color: #fff;
            cursor: pointer;
            margin: 16px;
            transition: background 0.2s;
        }
        .btn:hover {
            background: #005fa3;
        }
        .options {
            display: flex;
            justify-content: center;
            gap: 48px;
        }
        .text {
            font-size: 2em;
            color: #fff;
            text-shadow: 2px 2px 8px #000;
            margin-bottom: 32px;
            text-align: center;
        }
        /* æ–°å¢ï¼šæ·¡å…¥åŠ¨ç”» */
        .fade-in { animation: fadeIn .6s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* å£°éŸ³æŒ‰é’®æ ·å¼ */
        #soundBtn {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 10;
            background: rgba(0,0,0,.55);
            color: #fff;
            border: 1px solid rgba(255,255,255,.4);
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(4px);
            transition: background .2s;
        }
        #soundBtn:hover { background: rgba(0,0,0,.75); }
    </style>
</head>
<body>
    <div id="container"></div>
    <button id="soundBtn" style="display:none">ï¿½ å£°éŸ³å·²å¼€å¯</button>
    <script>
        const container = document.getElementById('container');
        const soundBtn = document.getElementById('soundBtn');
    let choices = [];
    let audioUnlocked = true; // åˆå§‹å°è¯•ç›´æ¥æ’­æ”¾æœ‰å£°

        // èµ„æºåˆ—è¡¨ï¼ˆé™¤ opening.mp4 ä»¥å¤–çš„æå‰é¢„åŠ è½½ï¼‰
        const preloadList = [
            'background1.jpg','background2.jpg','background3.jpg','background4.jpg',
            'video1.mp4','video2.mp4','video3.mp4','video4.mp4','video5.mp4','video6.mp4','video7.mp4','video8.mp4'
        ];

        function preloadAssets(list) {
            list.forEach(src => {
                if (src.endsWith('.jpg') || src.endsWith('.png') || src.endsWith('.jpeg')) {
                    const img = new Image();
                    img.src = src;
                } else if (src.endsWith('.mp4')) {
                    const v = document.createElement('video');
                    v.src = src;
                    v.preload = 'auto';
                    v.muted = true; // é¿å…åŠ è½½æç¤º
                }
            });
        }

        function playVideo(src, callback) {
            container.innerHTML = `<video class='background fade-in' src='${src}' autoplay playsinline></video>`;
            const video = container.querySelector('video');
            // æ ¹æ®çŠ¶æ€è®¾ç½®é™éŸ³
            video.muted = !audioUnlocked;
            if (audioUnlocked) {
                video.volume = 1;
            }
            const p = video.play();
            if (p && p.catch) {
                p.catch(err => {
                    // å¦‚æœæµè§ˆå™¨é˜»æ­¢äº†å¸¦å£°éŸ³è‡ªåŠ¨æ’­æ”¾ï¼Œé™çº§ä¸ºé™éŸ³å¹¶æ›´æ–°æŒ‰é’®
                    if (audioUnlocked) {
                        audioUnlocked = false;
                        video.muted = true;
                        const retry = video.play();
                        if (retry && retry.catch) retry.catch(()=>{});
                        soundBtn.textContent = 'ğŸ”‡ ç‚¹å‡»å¼€å¯å£°éŸ³';
                    }
                });
            }
            video.onended = () => callback && callback();
        }

        function showBackground(src, contentHtml = '') {
            container.innerHTML = `<img class='background fade-in' src='${src}' />${contentHtml}`;
        }

        // é”®ç›˜å·¦å³å¿«æ·é€‰æ‹©ï¼ˆå­˜åœ¨ .options æ—¶ï¼‰
        document.addEventListener('keydown', e => {
            const options = container.querySelector('.options');
            if (!options) return;
            if (e.key === 'ArrowLeft') {
                const first = options.querySelector('.btn');
                first && first.click();
            } else if (e.key === 'ArrowRight') {
                const btns = options.querySelectorAll('.btn');
                if (btns.length) btns[btns.length - 1].click();
            }
        });

        // å¼€åœºåŠ¨ç”»ï¼ˆåŒæ—¶é¢„åŠ è½½åç»­èµ„æºï¼‰
        preloadAssets(preloadList);
        playVideo('opening.mp4', () => {
            showBackground('background1.jpg', `
                <div class='center fade-in'>
                    <div class='text'>æ¬¢è¿æ¥åˆ°å¼€å¹•æ¸¸æˆ</div>
                    <button class='btn' onclick='startGame()'>å¼€å§‹æ¸¸æˆ</button>
                </div>
            `);
        });

        // å£°éŸ³æ§åˆ¶é€»è¾‘
        function enableSound() {
            if (audioUnlocked) return; // å·²ç»å¼€å¯
            audioUnlocked = true;
            soundBtn.textContent = 'ğŸ”Š å£°éŸ³å·²å¼€å¯';
            const v = container.querySelector('video');
            if (v) {
                v.muted = false;
                v.volume = 1;
                const r = v.play();
                if (r && r.catch) r.catch(()=>{});
            }
        }

        // æ˜¾ç¤ºæŒ‰é’®ï¼ˆé»˜è®¤æ˜¾ç¤ºä¸ºå¼€å¯çŠ¶æ€ï¼‰
        soundBtn.style.display = 'block';
        soundBtn.onclick = () => enableSound();

        window.startGame = function() {
            playVideo('video1.mp4', () => {
                playVideo('video2.mp4', () => {
                    showBackground('background2.jpg', `
                        <div class='center fade-in'>
                            <div class='text'>è¯·é€‰æ‹©ä½ çš„é“è·¯</div>
                            <div class='options'>
                                <button class='btn' onclick='chooseRoad(1)'>road1</button>
                                <button class='btn' onclick='chooseRoad(2)'>road2</button>
                                <button class='btn' onclick='chooseRoad(3)'>road3</button>
                            </div>
                        </div>
                    `);
                });
            });
        }

        window.chooseRoad = function(road) {
            playVideo('video3.mp4', () => {
                playVideo('video4.mp4', () => {
                    playVideo('video5.mp4', () => {
                        playVideo('video6.mp4', () => {
                            showBackground('background3.jpg', `
                                <div class='center fade-in'>
                                    <div class='text'>æ˜¯</div>
                                    <div class='options'>
                                        <button class='btn' onclick='chooseSide(0)'>å·¦</button>
                                        <button class='btn' onclick='chooseSide(1)'>å³</button>
                                    </div>
                                </div>
                            `);
                        });
                    });
                });
            });
        }

        window.chooseSide = function(side) {
            choices.push(side);
            if (choices.length === 1) {
                // ç¬¬äºŒæ¬¡å·¦å³é€‰æ‹©ï¼ˆè¯´æ˜ï¼šåŸæè¿°å†™ background4.mp4ï¼Œæ­¤å¤„ç´ æä¸º background4.jpgï¼‰
                showBackground('background4.jpg', `
                    <div class='center fade-in'>
                        <div class='options'>
                            <button class='btn' onclick='chooseSide(0)'>å·¦</button>
                            <button class='btn' onclick='chooseSide(1)'>å³</button>
                        </div>
                    </div>
                `);
            } else if (choices.length === 2) {
                if (choices[0] === choices[1]) {
                    playVideo('video8.mp4');
                } else {
                    playVideo('video7.mp4');
                }
            }
        }
    </script>
</body>
</html>
